<!DOCTYPE html>
<html lang="en">

<!--<script src="/static/js/jquery-3.2.1.min.js" type="text/javascript"></script>-->
<script src="/static/js/jquery-3.2.1.min.js" type="text/javascript"></script>
<script src="/static/js/highstock.js" type="text/javascript"></script>
<script src="/static/js/drag-panes.js" type="text/javascript"></script>
<script src="/static/js/exporting.js" type="text/javascript"></script>
<script src="/static/js/dark-unica.js" type="text/javascript"></script>
<script src="/static/js/highcharts-zh_CN.js" type="text/javascript"></script>


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Highstock Example</title>

    <link href="/static/css/flexible.css" rel="stylesheet">
    <script src="/static/js/flexible.js"></script>
    <style>
        html, body{
            width: 100%;
            height: 100%;
            position: relative;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }
        body{
            background: #333;
        }
        .container{
            overflow-x: hidden;
            overflow-y: auto;
            position: relative;
            height: 100%;
            max-width: 640px;
            background-color: white;
            margin: 0 auto;
        }
        .block{

            margin: 0 auto;
            margin-top: 1.5625rem;
            width: 3.75rem;
            height: 1.875rem;
            background-color: #0075a9;
        }
    </style>

</head>

<body>

    <div id="container" style="height: 400px; min-width: 310px" class="container"></div>

    <script type="text/javascript">

        $(function() {
                 //进度条
                /*
                 $('body').mLoading({
                    text:"申万宏源欢迎您，加载数据中",//加载文字，默认值：加载中...
                 });
                 */
                 //加载报价数据
                 loadQuotesData()

                //刷新页面，每隔10秒刷新一次数据
                //setInterval(refreshQuoteData,5000);
            });

        function loadQuotesData(){
            var url = '/FixedIncome/YTMAnalytic/loadData'
            $.ajax({
                type: 'POST',
                data:{
                },
                dataType: 'json',
                url: url,
                success: loadData,
                error: errorInfo,
                //采用异步
                async: true
            });
        }

        var loadData = function(data) {
            var seriesData = []
            //加载数据
            $.each(JSON.parse(data), function (i, item) {
                //console.log(item);
                seriesData.push([
                    str2UTC(item.timestamp),
                    parseFloat(item.bondytm)
                ])
            });
            //创建图形
            console.log(seriesData)
            createCharts(seriesData)
            //$('body').mLoading("hide");
        };

        function createCharts(data) {
            //关闭UTC时间
            Highcharts.setOptions({ global:{useUTC: false}});
            // Create the chart
            Highcharts.stockChart('container', {
                rangeSelector: {
                    selected: 0
                },
                title: {
                    text: 'USD to EUR exchange rate'
                },
                tooltip: {
                    style: {
                        width: '200px'
                    },
                    valueDecimals: 4,
                    shared: true
                },
                yAxis: {
                    title: {
                        text: 'Exchange rate'
                    }
                },
                tooltip: {
                    split: false,
                },
                series: [{
                    name: 'USD to EUR',
                    data: data,
                    id: 'dataseries'
                // the event marker flags
                }, {
                    type: 'flags',
                    data: [{}],
                    onSeries: 'dataseries',
                    shape: 'circlepin',
                    width: 16
                }]
            });
        }

        //错误信息处理界面
        var errorInfo = function(msg){
            console.log(msg);
            //关闭进度条
            //$('body').mLoading("hide");
        };

        function str2UTC(str) {
            date = new Date(Date.parse(str.replace(/-/g, "/")))
            //组成UTC
            var y =  date.getUTCFullYear();
            var m = date.getUTCMonth() ;
            var d = date.getUTCDate();
            var h= date.getUTCHours();
            var M = date.getUTCMinutes();
            var s = date.getUTCSeconds();
            //这里只选年月日，如有需要可以多选
            var utc = Date.UTC(y,m,d);
            return utc
        }

        /*
        var quoteData = [{{ series|safe }}];
        console.log(quoteData)

        //split the data set into ohlc and volume
        var ohlc = [];

        console.log(ohlc)
        $.each(quoteData[0], function(timeStamp, OHLC){
           ohlc.push([
                timeStamp, // the date
                OHLC.open, // open
                OHLC.high, // high
                OHLC.low, // low
                OHLC.close // close
            ]);
        });
      //  debugger;
        // create the chart
        Highcharts.stockChart('container', {

            rangeSelector: {
                selected: 1
            },

            title: {
                text: 'CU 价差'
            },

            xAxis: {
                type: 'category',
            },

            yAxis: [{
                labels: {
                    align: 'right',
                    x: -3
                },
                title: {
                    text: 'OHLC'
                },
                height: '60%',
                lineWidth: 2,
                resize: {
                    enabled: true
                }
            }, {
                labels: {
                    align: 'right',
                    x: -3
                },
                title: {
                    text: 'Volume'
                },
                top: '65%',
                height: '35%',
                offset: 0,
                lineWidth: 2
            }],

            tooltip: {
                split: true
            },

            series: [{
                type: 'candlestick',
                name: 'CU',
                data: ohlc,
                dataGrouping: {
                    units: [
                        [
                            'week', // unit name
                            [1] // allowed multiples
                        ], [
                            'month',
                            [1, 2, 3, 4, 6]
                        ]
                    ]
                }}
            ]
        });
        */
    </script>


</body>
</html>