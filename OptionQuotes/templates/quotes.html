<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <!--允许全屏-->
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="yes" name="apple-touch-fullscreen">
        <meta content="telephone=no,email=no" name="format-detection">
{#        <meta http-equiv="refresh" content="20">#}
        <script src="/static/js/flexible_css.debug.js"></script>
        <script src="/static/js/flexible.debug.js"></script>
        <script src="/static/js/jquery-3.2.1.min.js"></script>
        <title>申万宏源FICC</title>
        <link href="/static/css/quotes.css" rel="stylesheet" type="text/css">

        <style>
            html,body{
                height: 100vh;
                background-color: #050505;
            }
        </style>
    </head>

    <body>
    <!-- Item Header Template -->
        <div class="html_content">
            <div class="item-section" data-repeat="sections">
                <div class="item-section_header">
                    <h2>申万宏源证券有限公司--期权报价</h2>
                </div>

                <table id="optionTable" class="table">
                    <tr id="tableTitle">
                        <th class="table-th">品种</th>
                        <th class="table-th">标的</th>
                        <th class="table-th">标的价格</th>
                        <th class="table-th">买价</th>
                        <th class="table-th">卖价</th>
                    </tr>
                </table>

            </div>
        </div>

        <script>

             $(function() {
                 //从后端获取数据
                 var quoteData = [{{ series|safe }}];
                 console.log(quoteData[0])

                 //解析json数据
                 $.each(quoteData[0], function(i, item){
                     var newRow='<tr id="'+i+'" style="background-color:#050505">' +
                        '<td class="table-td" tr id="'+i+'item"> <a href="../quotes/TQuotes/' + i + '\" style="text-decoration: none; color: inherit;" >'+ item.name + '</a>' +'</td>' +
                        '<td class="table-td" tr id="'+i+'contract">'+ i +'</td>' +
                        '<td class="table-td" tr id="'+i+'forward">'+ item.forward +'</td>' +
                        '<td class="table-td" tr id="'+i+'pricingAsk">'+ item.pricingAsk +'</td>' +
                        '<td class="table-td" tr id="'+i+'pricingBid">'+ item.pricingBid +'</td>';
                    $('#optionTable').append(newRow);
                 });

                //刷新页面，每隔10秒刷新一次数据
                setInterval(refreshQuoteData,10000);
            });

             function refreshQuoteData() {
                 var url = '/quotes/updateQuotes/'
                 $.ajax({
                     type: 'POST',
                     data:{
                         test:'test'
                     },
                     dataType: 'json',
                     url: url,
                     success: updateData,
                     error : errorInfo,
                     async: false
                 });
             }

            var updateData = function(data){
                //更新数据
                console.log(data);
                $.each(data, function(i, item) {
                    changeFont('#'+i+'item', 'aaa');
                    alert('#'+i+'item');
                    changeFont('#'+i+'contract', i);
                    changeFont('#'+i+'forward', item.forward);
                    changeFont('#'+i+'pricingAsk', item.pricingAsk);
                    changeFont('#'+i+'pricingBid', item.pricingBid);
                });
            };

            // 更改内容渐变字体
            function changeFont(id, text) {
	            $(id).animate({ opacity: '0', fontSize: '18px' }, 1000, function () {
		            $(this).html(text);
	            }).animate({ opacity: '1' }, 1000);
            }
             var errorInfo = function (msg){

            };


        </script>
    </body>
</html>